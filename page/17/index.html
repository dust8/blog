<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dust8.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="读书百遍其义自见">
<meta property="og:type" content="website">
<meta property="og:title" content="Dust8 的博客">
<meta property="og:url" content="https://dust8.github.io/blog/page/17/index.html">
<meta property="og:site_name" content="Dust8 的博客">
<meta property="og:description" content="读书百遍其义自见">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dust8 的博客">
<meta name="twitter:description" content="读书百遍其义自见">

<link rel="canonical" href="https://dust8.github.io/blog/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Dust8 的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/blog/atom.xml" title="Dust8 的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Dust8 的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">读书百遍其义自见</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/03/22/news-163-comment-crawler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content="读书百遍其义自见">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/03/22/news-163-comment-crawler/" class="post-title-link" itemprop="url">网易新闻评论爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-22 05:15:31" itemprop="dateCreated datePublished" datetime="2017-03-22T05:15:31+00:00">2017-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-23 12:45:57" itemprop="dateModified" datetime="2023-03-23T12:45:57+00:00">2023-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>昨天有 _ boss _ 给我出了一道爬虫题，让我爬网易新闻的评论，我说试下。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="一级入口"><a href="#一级入口" class="headerlink" title="一级入口"></a>一级入口</h3><p>网易新闻的入口：_ news.163.com _</p>
<h3 id="二级人口："><a href="#二级人口：" class="headerlink" title="二级人口："></a>二级人口：</h3><p><img src="/assert/2017-03-22-1.png" alt><br>点击进去查看源代码，发现没有内容，可以知道它是 <strong> 动态加载 </strong> 的。<br>通过 _ Network _ 里面的 _ XHR _，并没有发现请求，查看 <strong> JS </strong><br>发现一个可疑请求<br><img src="/assert/2017-03-22-2.png" alt><br>就是它了 <strong> <a href="http://temp.163.com/special/00804KVA/cm_guonei.js?callback=data_callback" target="_blank" rel="noopener">http://temp.163.com/special/00804KVA/cm_guonei.js?callback=data_callback</a> </strong><br>通过它就可以得到 <strong> guonei </strong> 的最近新闻内容）。</p>
<blockquote>
<p>注意这里 <strong> cm_guonei </strong> 和开始进来的 <strong> domestic </strong>，它们名字并不统一</p>
</blockquote>
<h3 id="评论入口"><a href="#评论入口" class="headerlink" title="评论入口"></a>评论入口</h3><p>同理可以发现<br><img src="/assert/2017-03-22-3.png" alt></p>
<ul>
<li>最热评论 hotList</li>
<li>最新评论 newList</li>
</ul>
<blockquote>
<p>注意每个二级的评论接口有可能不一样。比如国内新闻的评论接口是 <strong> <a href="http://comment.news.163.com" target="_blank" rel="noopener">http://comment.news.163.com</a> </strong>，<br>而军事评论接口是 <strong> <a href="http://comment.war.163.com" target="_blank" rel="noopener">http://comment.war.163.com</a> </strong></p>
</blockquote>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>用 _ scrapy _ 来写也很简单，平常那种连续 2 次解析就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> NewsItem, CommentItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewsSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'news'</span></span><br><span class="line">    CM_API_BASE_URL = <span class="string">'http://temp.163.com/special/00804KVA/cm_&#123;&#125;.js?callback=data_callback'</span></span><br><span class="line">    NEW_LIST_API_BASE_URL = <span class="string">'http://comment.news.163.com/api/v1/products/a2869674571f77b5a0867c3d71db5856/threads/&#123;&#125;/comments/newList?offset=0&amp;limit=30&amp;showLevelThreshold=72&amp;headLimit=1&amp;tailLimit=2&amp;callback=getData&amp;ibc=newspc'</span></span><br><span class="line">    pingdao = [<span class="string">'shehui'</span>, <span class="string">'guoji'</span>,<span class="string">'war'</span>]</span><br><span class="line">    start_urls = [CM_API_BASE_URL.format(<span class="string">'guonei'</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        cm_re = re.compile(<span class="string">'data_callback\((.*)\)'</span>, re.DOTALL)</span><br><span class="line">        m = cm_re.match(response.body.decode(<span class="string">'gb18030'</span>))</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            newses = json.loads(m.group(<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">for</span> news <span class="keyword">in</span> newses:</span><br><span class="line">                item = NewsItem()</span><br><span class="line">                item[<span class="string">'channelname'</span>] = news[<span class="string">'channelname'</span>]</span><br><span class="line">                item[<span class="string">'docurl'</span>] = news[<span class="string">'docurl'</span>]</span><br><span class="line">                item[<span class="string">'time'</span>] = news[<span class="string">'time'</span>]</span><br><span class="line">                item[<span class="string">'title'</span>] = news[<span class="string">'title'</span>]</span><br><span class="line">                item[<span class="string">'threadid'</span>] = news[<span class="string">'docurl'</span>][<span class="number">-21</span>:<span class="number">-5</span>]</span><br><span class="line">                <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line">                request = scrapy.Request(self.NEW_LIST_API_BASE_URL.format(item[<span class="string">'threadid'</span>]),</span><br><span class="line">                    callback=self.parse_comment)</span><br><span class="line">                request.meta[<span class="string">'threadid'</span>] = item[<span class="string">'threadid'</span>]</span><br><span class="line">                <span class="keyword">yield</span> request</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_comment</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        threadid = response.meta[<span class="string">'threadid'</span>]</span><br><span class="line">        new_list_re = re.compile(<span class="string">'getData\((.*)\)'</span>, re.DOTALL)</span><br><span class="line">        m = new_list_re.match(response.body.decode())</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            comments = json.loads(m.group(<span class="number">1</span>))[<span class="string">'comments'</span>]</span><br><span class="line">            <span class="keyword">for</span> _, value <span class="keyword">in</span> comments.items():</span><br><span class="line">                <span class="comment"># print(value)</span></span><br><span class="line">                item = CommentItem()</span><br><span class="line">                item[<span class="string">'commentid'</span>] = value[<span class="string">'commentId'</span>]</span><br><span class="line">                item[<span class="string">'content'</span>] = value[<span class="string">'content'</span>]</span><br><span class="line">                item[<span class="string">'createtime'</span>] = value[<span class="string">'createTime'</span>]</span><br><span class="line">                item[<span class="string">'threadid'</span>] = threadid</span><br><span class="line">                item[<span class="string">'nickname'</span>] = value[<span class="string">'user'</span>].get(<span class="string">'nickname'</span>, <span class="string">'anonymous'</span>)</span><br><span class="line">                item[<span class="string">'userid'</span>] = value[<span class="string">'user'</span>].get(<span class="string">'userId'</span>, <span class="string">'0'</span>)</span><br><span class="line">                <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<h2 id="抓取结果"><a href="#抓取结果" class="headerlink" title="抓取结果"></a>抓取结果</h2><p>只抓取了一次国内新闻。共 _ 70 _ 条新闻，_ 2012 _ 条评论。<br><img src="/assert/2017-03-22-4.png" alt><br><img src="/assert/2017-03-22-5.png" alt></p>
<h2 id="需要改进的"><a href="#需要改进的" class="headerlink" title="需要改进的"></a>需要改进的</h2><ul>
<li>因为抓取的都是最近新闻，可能没有多少评论，需要以后再次抓取评论来提高评论的数量</li>
<li>过去的新闻没有去抓</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/03/15/first-coder-interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content="读书百遍其义自见">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/03/15/first-coder-interview/" class="post-title-link" itemprop="url">第一次编程工作面试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-15 05:15:31" itemprop="dateCreated datePublished" datetime="2017-03-15T05:15:31+00:00">2017-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-23 12:45:57" itemprop="dateModified" datetime="2023-03-23T12:45:57+00:00">2023-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>想转行做编程工作，平时自学python，玩过不少东西，但掌握的少之又少，看来还是要专一门<br>学精一些。网上投了不少简历，有一半都根本看都没看过简历，剩下的都是回复不合适，只有<br>昨天有一家给了面试机会，自己掌握不精，平时没怎么记，习惯用自动补全，有点丢人啊。还被<br>高德坑了下，说是一个半小时的路程，光在车上就花费了两个半小时。</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="问怎么知道python安装没有，还有就是怎么看python的版本号"><a href="#问怎么知道python安装没有，还有就是怎么看python的版本号" class="headerlink" title="问怎么知道python安装没有，还有就是怎么看python的版本号"></a>问怎么知道python安装没有，还有就是怎么看python的版本号</h3><p>这个简直是送分题<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> python</span><br><span class="line">python --version</span><br></pre></td></tr></table></figure></p>
<h3 id="给‘xxx-xx-xxxx’让提取数字并从大到小排序"><a href="#给‘xxx-xx-xxxx’让提取数字并从大到小排序" class="headerlink" title="给‘xxx xx xxxx’让提取数字并从大到小排序"></a>给‘xxx xx xxxx’让提取数字并从大到小排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">'dust dust8  1234 45 90'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filter_nums</span><span class="params">(line)</span>:</span></span><br><span class="line">    str_nums = line.split()</span><br><span class="line">    nums = [int(num) <span class="keyword">for</span> num <span class="keyword">in</span> str_nums <span class="keyword">if</span> num.isnumeric()]</span><br><span class="line">    nums.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">filter_nums(line)</span><br></pre></td></tr></table></figure>
<p>这里我 <strong>isnumeric</strong> 没写出来，只知道有这么个函数可以判断是否是数字，还有就是漏了<br><strong>int</strong> 会导致排序不正确。早知道用正则好了。</p>
<h3 id="就是考察django的数据库查询，有2个限制条件"><a href="#就是考察django的数据库查询，有2个限制条件" class="headerlink" title="就是考察django的数据库查询，有2个限制条件"></a>就是考察django的数据库查询，有2个限制条件</h3><p>我没怎么看django，上午在吊水，下午复习了下python基本知识，晚上只看了几章django。<br>导致没写出来。回来看了下有3种方法。</p>
<ul>
<li><code>filter(quantity__gt=5, price__lt=10)</code></li>
<li><code>filter(quantity__gt=5).filter(price__lt=10)</code></li>
<li><code>filter(Q(quantity__gt=5)&amp;Q(price__lt=10))</code></li>
</ul>
<h3 id="叫用django的内置tags来写个表格"><a href="#叫用django的内置tags来写个表格" class="headerlink" title="叫用django的内置tags来写个表格"></a>叫用django的内置tags来写个表格</h3><p>django的内置tags有哪些我还没看过，就用html写了下<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">rowspan</span>=<span class="string">"2"</span>&gt;</span>订单<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"3"</span>&gt;</span>流程<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>A<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>B<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>C<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里我知道有个属性可以控制它的占用的空间，也没写对，就是<strong>rowspan</strong> <strong>colspan</strong>。<br>还有就是django内置的tags，我就写了<br><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> x <span class="keyword">in</span> xx %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123; x.x &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123; x.y &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>其实 <strong>for</strong> 就是django内置的一种tag，可惜我有点紧张，变量好像还忘记变量加双大括号。</p>
<h3 id="有个思考题，说怎么测量路上的通车数量"><a href="#有个思考题，说怎么测量路上的通车数量" class="headerlink" title="有个思考题，说怎么测量路上的通车数量"></a>有个思考题，说怎么测量路上的通车数量</h3><p>回答的不是很好，写了射线类测量，人类计数，图像识别，还要思考他们的准确性和成本。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不知道这几道题目是否是为我特意出的，感觉很简单，只是平时只是图好玩，没怎么记，只是记住了<br>流程，可以这样做，做的时候查下文档就可以弄出来了。看来平时要多记啊。</p>
<p>学历不高，年纪稍大，没有经验，总是追求新技术，导致什么都知道一些，做的时候要复习下，<br>又没有专精哪一门，不知道谁能收留下，我应该可以很快进入工作状态。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/03/08/stuq-spider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content="读书百遍其义自见">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/03/08/stuq-spider/" class="post-title-link" itemprop="url">stuq动态爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-08 05:15:31" itemprop="dateCreated datePublished" datetime="2017-03-08T05:15:31+00:00">2017-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-23 12:45:57" itemprop="dateModified" datetime="2023-03-23T12:45:57+00:00">2023-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近看了下 <strong>openrestry</strong> ，它是 <strong>ngnix</strong> 和 <strong>lua</strong> 的结合体，用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。可以构造出足以胜任 10K 乃至 1000K 以上单机并发连接的高性能 Web 应用系统。搜索它的视频资料，一个在网易云课堂上，只有 1/3 的内容，另外一个在 <em>stuq</em> 上，是全部内容。我就想把视频爬下来。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="分析视频地址"><a href="#分析视频地址" class="headerlink" title="分析视频地址"></a>分析视频地址</h3><p>通过 chrome 开发工具的 <em>Elements</em> 发现没有直接暴露地址，是用 flash 播放的，同时可以知道视频的 id 用 <strong>vid</strong> 来表示。<br>通过 <strong>Network</strong> 可以发现几个有用的请求。它们是 <strong>getvideofile</strong> <strong>player.swf</strong> <strong>playinfo</strong>.<br>真实的视频地址就在 <strong>playinfo</strong> 这个请求里面。分析这个请求的查询参数<br>可以知道只有 2 个参数是必须的，一个是 <strong>vid</strong>(视频 id), 一个是 <strong>m</strong> 它是固定的。当时还反编译了一下 <strong>player.swf</strong> 看了下其他参数是什么。其实这个接口没有怎么防范，通过不停的减少参数就可以把这个分析出来。</p>
<h3 id="分析视频列表"><a href="#分析视频列表" class="headerlink" title="分析视频列表"></a>分析视频列表</h3><p>查看网页源代码可以看到有视频的 id，有 2 个问题是，一个是要登录，一个是它用的是 <strong>vue</strong> 。而且也没有发现有 api 请求，所以只能用 <strong>selenium</strong> 来模拟请求了。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>我把抓取视频 id 和下载视频分开，用 <strong>selenium</strong> 来抓取视频 id 和文件名列表，保存为 json，在用 <strong>aiohttp</strong> 来下载视频文件，所以会快些。</p>
<p>stuq_spider.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StuqSpider</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.driver = webdriver.Chrome(<span class="string">'/Users/tom/workspace/chromedriver'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crawl_course</span><span class="params">(self, courseid)</span>:</span></span><br><span class="line">        coursewares = self.get_coursewares(courseid)</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> coursewares:</span><br><span class="line">            info = self.get_video_info(url)</span><br><span class="line">            data.append(info)</span><br><span class="line">        self.store_data(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login_weibo</span><span class="params">(self, username, password)</span>:</span></span><br><span class="line">        self.driver.get(<span class="string">'https://passport.stuq.org/user/login'</span>)</span><br><span class="line">        self.driver.find_element_by_xpath(<span class="string">'//a[@class="button weibo"]'</span>).click()</span><br><span class="line"></span><br><span class="line">        userid = self.driver.find_element_by_id(<span class="string">'userId'</span>)</span><br><span class="line">        userid.send_keys(username)</span><br><span class="line">        passwd = self.driver.find_element_by_id(<span class="string">'passwd'</span>)</span><br><span class="line">        passwd.send_keys(password)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 放慢速度好伪装</span></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        self.driver.find_element_by_xpath(</span><br><span class="line">            <span class="string">'//*[@id="outer"]/div/div[2]/form/div/div[2]/div/p/a[1]'</span></span><br><span class="line">        ).send_keys(Keys.ENTER)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 手动登录,要输入验证码</span></span><br><span class="line">        time.sleep(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_coursewares</span><span class="params">(self, courseid)</span>:</span></span><br><span class="line">        coursewares = []</span><br><span class="line">        self.driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line">        self.driver.get(<span class="string">'http://www.stuq.org/course/'</span> + courseid + <span class="string">'/study'</span>)</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> self.driver.find_elements_by_xpath(<span class="string">'//p[@class="video"]/a'</span>):</span><br><span class="line">            coursewares.append(a.get_attribute(<span class="string">'href'</span>))</span><br><span class="line">        <span class="keyword">return</span> coursewares</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_video_info</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        self.driver.implicitly_wait(<span class="number">2</span>)</span><br><span class="line">        self.driver.get(url)</span><br><span class="line">        h2 = self.driver.find_element_by_tag_name(<span class="string">'h2'</span>).text</span><br><span class="line">        videoid = self.driver.find_element_by_xpath(</span><br><span class="line">            <span class="string">'//section[@id="cc-video"]/div'</span>).get_attribute(<span class="string">'id'</span>).split(<span class="string">'_'</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> [h2, videoid]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">store_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'stuq.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            json.dump(data, fp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.driver.close()</span><br><span class="line">        self.driver.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">username = <span class="string">''</span> <span class="comment"># sina 账号</span></span><br><span class="line">password = <span class="string">''</span> <span class="comment"># sina 密码</span></span><br><span class="line">courseid = <span class="string">'1015'</span></span><br><span class="line"></span><br><span class="line">spider = StuqSpider()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    spider.login_weibo(username, password)</span><br><span class="line">    spider.crawl_course(courseid)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    spider.close()</span><br></pre></td></tr></table></figure>
<p>bokecc_crawler.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://p.bokecc.com/servlet/playinfo?m=1&amp;vid='</span></span><br><span class="line">chunk_size = <span class="number">64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crawler</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max_task=<span class="number">4</span>, loop=None)</span>:</span></span><br><span class="line">        self.max_task = <span class="number">4</span></span><br><span class="line">        self.loop = loop <span class="keyword">or</span> asyncio.get_event_loop()</span><br><span class="line">        self.q = asyncio.Queue(loop=self.loop)</span><br><span class="line">        self.session = aiohttp.ClientSession(loop=self.loop)</span><br><span class="line">        self.t0 = self.t1 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_task</span><span class="params">(self, task)</span>:</span></span><br><span class="line">        self.q.put_nowait(task)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(self)</span>:</span></span><br><span class="line">        workers = [</span><br><span class="line">            asyncio.Task(self.work(), loop=self.loop)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.max_task)</span><br><span class="line">        ]</span><br><span class="line">        self.t0 = time.time()</span><br><span class="line">        <span class="keyword">await</span> self.q.join()</span><br><span class="line">        self.t1 = time.time()</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> workers:</span><br><span class="line">            w.cancel()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                filename, vid = <span class="keyword">await</span> self.q.get()</span><br><span class="line">                print(<span class="string">'working:'</span>, filename, vid)</span><br><span class="line">                xmldata = <span class="keyword">await</span> self.fetch(base_url + vid)</span><br><span class="line">                root = ET.fromstring(xmldata)</span><br><span class="line">                copys = root.findall(<span class="string">".//copy"</span>)</span><br><span class="line">                playurl = copys[<span class="number">-1</span>].attrib[<span class="string">'playurl'</span>]</span><br><span class="line">                <span class="keyword">await</span> self.download_video(playurl, filename)</span><br><span class="line">                self.q.task_done()</span><br><span class="line">        <span class="keyword">except</span> asyncio.CancelledError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">fetch</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> self.session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">download_video</span><span class="params">(self, url, filename)</span>:</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> self.session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">with</span> open(os.path.join(<span class="string">'videos'</span>, filename), <span class="string">'wb'</span>) <span class="keyword">as</span> fd:</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    chunk = <span class="keyword">await</span> response.content.read(chunk_size)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    fd.write(chunk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.session.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'total time: '</span>, self.t1 - self.t0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">crawler = Crawler(loop=loop)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'stuq.json'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    data = json.load(fp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename, vid <span class="keyword">in</span> data:</span><br><span class="line">    filename += <span class="string">'.flv'</span></span><br><span class="line">    crawler.add_task((filename, vid))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    loop.run_until_complete(crawler.crawl())</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    crawler.report()</span><br><span class="line">    crawler.close()</span><br></pre></td></tr></table></figure>
<h2 id="爬取成果"><a href="#爬取成果" class="headerlink" title="爬取成果"></a>爬取成果</h2><p>爬了 20 分钟，下了 29 个视频，共 2.1G。<br><img src="/assert/2017-03-08-stuq.png" alt="stuq_spider"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/03/07/chrome-xpath/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content="读书百遍其义自见">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/03/07/chrome-xpath/" class="post-title-link" itemprop="url">chrome与xpath</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-07 05:15:31" itemprop="dateCreated datePublished" datetime="2017-03-07T05:15:31+00:00">2017-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-23 12:45:57" itemprop="dateModified" datetime="2023-03-23T12:45:57+00:00">2023-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>平常喜欢写爬虫，写爬虫肯定要提取信息，如果用 <strong>正则表达式</strong> 就太麻烦了，所以很多库都<br>集成了 <strong>xpath</strong> 选择器。如果不太熟练或者想测试 <strong>xpath</strong> 的话就有点不方便，<br>网上没有比较好的插件或工具。其实 <strong>chrome</strong> 里面的开发工具就可以很好的导出和测试 <strong>xpath</strong>。</p>
<h2 id="chrome-开发工具"><a href="#chrome-开发工具" class="headerlink" title="chrome 开发工具"></a>chrome 开发工具</h2><p>打开 chrome 开发工具有 3 种方式</p>
<ul>
<li>在页面右键 &gt; inspect</li>
<li>右上角设置 &gt; More Tools &gt; Developer Tools</li>
<li>快捷键<ul>
<li>macos: option(alt)+command+i</li>
</ul>
</li>
</ul>
<h2 id="提取-xpath"><a href="#提取-xpath" class="headerlink" title="提取 xpath"></a>提取 xpath</h2><p>在 <strong>Elements</strong> 里面选择要提取的元素，右键 Copy &gt; Copy Xpath。这种方式虽然方便，还是有很多不足。<br>例如层级太深，只能选一个元素，这样兼容性不太好，网站稍微改一下就不行了，需要自己改动下，通过类名或者 id 等等来提高。</p>
<p><img src="/assert/2017-03-07-export-xpath.gif" alt="export-xpath"></p>
<h2 id="测试-xpath"><a href="#测试-xpath" class="headerlink" title="测试 xpath"></a>测试 xpath</h2><p>在 <strong>Console</strong> 里面用 <strong>\$x(path)</strong> 来测试是否可以提取到元素。<br><a href="https://developers.google.com/web/tools/chrome-devtools/console/command-line-reference?utm_source=dcc&amp;utm_medium=redirect&amp;utm_campaign=2016q3#xpath" target="_blank" rel="noopener">\$x(path)</a><br>返回一个与给定 XPath 表达式匹配的 DOM 元素数组。<br>记得这里只能提取元素，不能提取元素的属性。</p>
<p><img src="/assert/2017-03-07-test-xpath.png" alt="test-xpath"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/02/16/speech-to-text-use-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content="读书百遍其义自见">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/02/16/speech-to-text-use-python/" class="post-title-link" itemprop="url">使用python来语音转文字</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-16 05:15:31" itemprop="dateCreated datePublished" datetime="2017-02-16T05:15:31+00:00">2017-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-23 12:45:57" itemprop="dateModified" datetime="2023-03-23T12:45:57+00:00">2023-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天在 <em>youtube</em> 上看到 <a href="https://www.youtube.com/watch?v=31DZfkYRvI4" target="_blank" rel="noopener">[Open Jarvis] 如何讓Python 自動將語音轉譯成文字?</a>, 就想到前段时间想<br>把没有字幕的视频里面的语音转成文字, 这样好理解一些(英语渣的苦,谁渣谁知道).<br>找了半天都是要申请 <em>api key</em> 还有各种限制, 比如收费(哈哈).</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h3><p>官网: <a href="http://ffmpeg.org/" target="_blank" rel="noopener">http://ffmpeg.org/</a><br>这里用它来提取视频里面的音频.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure></p>
<h3 id="SpeechRecognition"><a href="#SpeechRecognition" class="headerlink" title="SpeechRecognition"></a>SpeechRecognition</h3><p><a href="https://pypi.python.org/pypi/SpeechRecognition/" target="_blank" rel="noopener">SpeechRecognition</a><br>它是把在线的,离线的,各种aip接口集合在一起,然后提供统一的接口.<br>因为我不喜欢要申请key的,所以只能用离线的 <em>CMU Sphinx</em>.</p>
<p>先去 <a href="http://cmusphinx.sourceforge.net/wiki/download" target="_blank" rel="noopener">CMUSphinx</a>下载安装 <em>sphinxbase</em> <em>pocketsphinx</em>, 可以看 <a href="https://github.com/cmusphinx/pocketsphinx" target="_blank" rel="noopener">cmusphinx/pocketsphinx</a>.<br>在安装它们之前还要安装 <em>swig</em>,不然会报错.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install swig</span><br></pre></td></tr></table></figure></p>
<p>都安装好后在<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pocketsphinx</span><br></pre></td></tr></table></figure></p>
<h2 id="提取音频"><a href="#提取音频" class="headerlink" title="提取音频"></a>提取音频</h2><p>比如我要提取 <a href="https://www.destroyallsoftware.com/screencasts" target="_blank" rel="noopener">das-0091-introduction-to-computation-4k.mp4</a> 的音频为 <em>test.wav</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i das-0091-introduction-to-computation-4k.mp4 -vn test.wav</span><br></pre></td></tr></table></figure></p>
<p>因为 <em>AudioFile</em> 接口只支持 <em>WAV/AIFF/FLAC</em>, 所以用的是 <em>wav</em>.</p>
<h2 id="提取文字"><a href="#提取文字" class="headerlink" title="提取文字"></a>提取文字</h2><p>可以看官方的例子 <a href="https://github.com/Uberi/speech_recognition/blob/master/examples/audio_transcribe.py" target="_blank" rel="noopener">audio_transcribe.py</a> 很简单.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> speech_recognition <span class="keyword">as</span> sr</span><br><span class="line"></span><br><span class="line">r = sr.Recognizer()</span><br><span class="line"><span class="keyword">with</span> sr.AudioFile(<span class="string">'test.wav'</span>) <span class="keyword">as</span> source:</span><br><span class="line">    audio = r.record(source)</span><br><span class="line"></span><br><span class="line">r.recognize_sphinx(audio)</span><br></pre></td></tr></table></figure></p>
<p>输出如下:    </p>
<blockquote>
<p>this series is going to cover competition and i think we should begin by just laying out the topics are going to mention along the way so we have a sense of where we’re going the first of those topics is the radical simplicity of computation it turns out that all the complexity of our computers and programming languages and operating systems is comp complexity that we have added it is not fundamental to computation and to see that we’re going to look both at the turn machine and abby lana calculus which are the two most well known models of computation were these the two most well known abstract models both of these are normally talk with the very mathematical kind of terminology indication lot of greek letters and so on but we’re just going to use python code because python is aline was any programmer can understand pretty easily and that wall hours to get at least a high level understanding of what’s going on inside of the systems the next topic that we’re going to talk about is the limits of computation specifically be holding problem which is an example of an undesirable problem at the computer science be holding problems as they did really quickly is the problem of writing a function let’s call a halt it takes another function of scott after the decides whether half will terminate we’re not itself will terminate eventually then hold your return troops itself wolford sample would forever than a halt to return faults and it’s easy to state that problem as i just did it but you cannot write this launch and no programming language can express this function no computational system can express his function at the highly non obvious result but there are rigorous mathematical proof so this going back to the nineteen thirty’s and they have held up for a year’s both in theory and practice so will see why that’s true are these the high level sketch of why that’s true and some of the implications of it for the rest of computation we’re also going to see the structure of computation specifically the idea of trying equivalents which tells us that the turing machine and amanda calculus are both capable of answering the same questions any question that one of them can answer the other cancer and it turns out to this is true of our real world computers as well including the laptop and i’m recording this on if my laptop unanswered question and so could turn machine and this is extremely surprising given how simple turn machines are exactly first look at them you’re not going to believe that their actual general purpose computer system but it turns out that in fact they are because of turner problems which once again as a rigorous mathematical proof is going back to the nineteen eighties excuse me hit eighty years ago the nineteen thirty’s a related idea that will talk about is the chon ski hierarchy of computational systems and it turns out that this turn of quo blood type of system is only the most powerful type of computation there are four levels and as hierarchy and they began with the weakest which is a bullet to what we called regular depressions the next level is what you would need if you wanted to recognize python code mi you want to decide whether as spring is valid python or is not about python the next levels which would need if you wanted to recognize as c. plus plus code and this distinction is very important in fact python was intentionally designed to require less complexity in the top additional system that recognizes that most programming languages have this level of complex including for example a job as script and one of the reasons the python is so we see the lord and revisit potentially was designed to require less complexity finally the last level in this hierarchy is the turner problem level which contains trainers shane solana calculus my laptop and so on and this hierarchy is first of all amazing just as relates these things that seem unrelated if you haven’t learned as yet but that’s not even the most amazing thing about it the most amazing thing is it known tom speed created this hierarchy when he was studying linguistics he was studying natural languages like english and he establishes different levels of linguistic complexity which computer scientists then took the news for all kinds of things including programming languages but also categorizing finite state machines which fall into these different categories in different ways and will see all of these things are more detail as we go that’s all i want to say about this introduction next time we’re going to pick up trade machines were gonna ride that simulator that could be wrapped hemlines a code and take about ten minutes of soul be quite easy to write so i’ll see you next time for training sheets</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>例子很简单,主要时间花在安装包上面,提取出来的文字虽然还有错误, 但大体意思还是不难理解的.不知道其他在线的接口的效果怎么样,我个人觉得正确率应该会高些,有兴趣的可以自己试下.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/blog/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/26/">26</a><a class="extend next" rel="next" href="/blog/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">dust8</p>
  <div class="site-description" itemprop="description">读书百遍其义自见</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">130</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">146</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dust8" title="GitHub → https://github.com/dust8" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.the5fire.com/" title="http://www.the5fire.com/" rel="noopener" target="_blank">the5fire</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2011 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dust8</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script>
<script src="/blog/js/schemes/pisces.js"></script>
<script src="/blog/js/next-boot.js"></script>



  















  

  

</body>
</html>
